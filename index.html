<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AR A-Frame + MindAR — Практическая</title>

  <!-- A-Frame CDN -->
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>

  <!-- MindAR A-Frame компонент (image tracking) -->
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.4/dist/mindar-image-aframe.prod.js"></script>

  <style>
    body{margin:0;font-family:sans-serif}
    #ui{position:fixed;left:10px;top:10px;z-index:10}
    .btn{padding:8px;border-radius:6px;margin:4px}
    .hint{position:fixed;left:10px;bottom:10px;background:rgba(0,0,0,0.6);color:#fff;padding:8px;border-radius:6px}
  </style>
</head>
<body>

<div id="ui">
  <button class="btn" id="scaleUp">+</button>
  <button class="btn" id="scaleDown">−</button>
  <button class="btn" id="next">Next</button>
</div>
<div class="hint" id="hint">Наведите камеру на маркер</div>

<a-scene mindar-image="imageTargetSrc: targets.mind; maxTrack:1;" 
         embedded
         vr-mode-ui="enabled: false"
         renderer="colorManagement: true; physicallyCorrectLights: true">

  <a-assets>
    <a-asset-item id="m1" src="models/gnome.glb"></a-asset-item>
    <a-asset-item id="m2" src="models/keg.glb"></a-asset-item>
    <audio id="ping" src="sounds/ping.mp3"></audio>
  </a-assets>

  <a-entity light="type: ambient; intensity: 0.8"></a-entity>
  <a-entity light="type: directional; intensity: 0.6" position="0 1 1"></a-entity>

  <!-- MindAR root: все, что внутри — привязано к маркеру -->
  <a-entity mindar-image-target="targetIndex: 0">
    <a-entity id="model"
              gltf-model="#m1"
              position="0 0 0"
              rotation="0 0 0"
              scale="0.05 0.05 0.05"
              class="interactable">
    </a-entity>
  </a-entity>

  <!-- камера для взаимодействия -->
  <a-entity camera>
    <a-entity cursor="rayOrigin: mouse" raycaster="objects: .interactable"></a-entity>
  </a-entity>

</a-scene>

<script>
  // Простейшая логика кнопок
  const model = document.getElementById('model');
  const assets = ['#m1','#m2']; let idx = 0;
  document.getElementById('scaleUp').onclick = ()=> changeScale(1.2);
  document.getElementById('scaleDown').onclick = ()=> changeScale(1/1.2);
  document.getElementById('next').onclick = ()=>{
    idx = (idx+1)%assets.length; model.setAttribute('gltf-model', assets[idx]);
  };
  function changeScale(f){
    const s = model.getAttribute('scale');
    model.setAttribute('scale', `${s.x*f} ${s.y*f} ${s.z*f}`);
  }

  // события MindAR (targetFound/targetLost) — на элементе mindar-image-target
  const root = document.querySelector('[mindar-image-target]');
  root.addEventListener('targetFound', ()=> document.getElementById('hint').textContent='Маркер найден');
  root.addEventListener('targetLost', ()=> document.getElementById('hint').textContent='Наведите камеру на маркер');
</script>

</body>
</html>
