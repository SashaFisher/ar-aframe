<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>AR A-Frame + MindAR</title>

  <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    /* UI должен быть поверх всего и иметь высокий z-index */
    #ui {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 9999;
      display: flex;
      gap: 10px;
    }
    button {
      padding: 12px 16px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      border: 2px solid #fff;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }
    #hint {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      color: #fff;
      padding: 10px 20px;
      border-radius: 20px;
      z-index: 9999;
      pointer-events: none;
    }
  </style>
</head>

<body>

<!-- ВАЖНО: Проверьте, что ID кнопок совпадают со скриптом ниже -->
<div id="ui">
  <button id="btn-switch">Сменить модель</button>
  <button id="btn-plus">+</button>
  <button id="btn-minus">−</button>
</div>

<div id="hint">Наведи камеру на маркер</div>

<!-- Убрали embedded, добавили uiLoading/uiScanning: no чтобы не мешались -->
<a-scene 
  mindar-image="imageTargetSrc: targets.mind; uiLoading: no; uiScanning: no;" 
  vr-mode-ui="enabled: false" 
  device-orientation-permission-ui="enabled: false"
  renderer="colorManagement: true">

  <a-assets>
    <a-asset-item id="gnome-glb" src="gnome.glb"></a-asset-item>
    <a-asset-item id="keg-glb" src="keg.glb"></a-asset-item>
    <audio id="ping" src="ping.mp3" preload="auto"></audio>
  </a-assets>

  <a-camera mindar-image-camera look-controls="enabled: false"></a-camera>

  <a-entity id="marker" mindar-image-target="targetIndex: 0">
    <!-- Сразу добавляем обе модели, чтобы не было глюков при переключении -->
    <a-gltf-model id="model-gnome" src="#gnome-glb" position="0 0 0" scale="0.2 0.2 0.2" visible="false"></a-gltf-model>
    <a-gltf-model id="model-keg" src="#keg-glb" position="0 0 0" scale="0.2 0.2 0.2" visible="false"></a-gltf-model>
  </a-entity>

  <a-entity light="type: ambient; intensity: 0.7"></a-entity>
  <a-entity light="type: directional; intensity: 0.8" position="1 2 1"></a-entity>
</a-scene>

<script>
// Оборачиваем в window.onload, чтобы скрипт точно увидел кнопки в HTML
window.onload = () => {
  const gnome = document.getElementById('model-gnome');
  const keg = document.getElementById('model-keg');
  const marker = document.getElementById('marker');
  const sound = document.getElementById('ping');
  const hint = document.getElementById('hint');

  const btnSwitch = document.getElementById('btn-switch');
  const btnPlus = document.getElementById('btn-plus');
  const btnMinus = document.getElementById('btn-minus');

  let currentModel = gnome; 
  let targetFound = false;

  // Функция переключения
  btnSwitch.onclick = () => {
    console.log("Переключаю модель...");
    currentModel.setAttribute('visible', false);
    currentModel = (currentModel === gnome) ? keg : gnome;
    
    if (targetFound) {
      currentModel.setAttribute('visible', true);
    }
  };

  // Масштабирование
  const updateScale = (factor) => {
    const s = currentModel.getAttribute('scale');
    currentModel.setAttribute('scale', {
      x: s.x * factor,
      y: s.y * factor,
      z: s.z * factor
    });
  };

  btnPlus.onclick = () => updateScale(1.2);
  btnMinus.onclick = () => updateScale(0.8);

  // События маркера
  marker.addEventListener('targetFound', () => {
    targetFound = true;
    currentModel.setAttribute('visible', true);
    hint.style.display = 'none';
    sound.currentTime = 0;
    sound.play().catch(() => {});
  });

  marker.addEventListener('targetLost', () => {
    targetFound = false;
    gnome.setAttribute('visible', false);
    keg.setAttribute('visible', false);
    hint.style.display = 'block';
  });
};
</script>

</body>
</html>
